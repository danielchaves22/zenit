Zenit Core Financial Management System

## üìã Vis√£o Geral

O **Zenit Core** √© um sistema backend enterprise de gest√£o financeira multi-tenant, desenvolvido para oferecer controle granular sobre opera√ß√µes financeiras com foco em seguran√ßa, integridade de dados e escalabilidade. O sistema foi projetado seguindo padr√µes enterprise e melhores pr√°ticas de desenvolvimento para aplica√ß√µes financeiras cr√≠ticas.

## üéØ Filosofia e Objetivos

### Conceito Principal
O Zenit Core foi concebido como uma plataforma robusta para gest√£o financeira empresarial, onde cada empresa (tenant) pode gerenciar suas opera√ß√µes financeiras de forma isolada e segura, com controle granular de permiss√µes por usu√°rio.

### Princ√≠pios Fundamentais
- **Integridade de Dados**: Transa√ß√µes ACID com isolamento SERIALIZABLE
- **Seguran√ßa por Design**: Controle de acesso granular e auditoria completa
- **Escalabilidade**: Arquitetura preparada para crescimento horizontal
- **Observabilidade**: Monitoramento completo com m√©tricas e logs estruturados
- **Confiabilidade**: Sistema de retry e fallbacks para opera√ß√µes cr√≠ticas

## üèóÔ∏è Arquitetura T√©cnica Backend

### Stack Tecnol√≥gico

**Core**
- **Runtime**: Node.js 20+ com TypeScript
- **Framework**: Express.js 4.21.2
- **Database**: PostgreSQL com Prisma ORM 6.8.2
- **Cache**: Redis 7 (opcional/configur√°vel)

**Seguran√ßa**
- **Autentica√ß√£o**: JWT com refresh tokens
- **Autoriza√ß√£o**: Sistema de roles e permiss√µes granular
- **Rate Limiting**: rate-limiter-flexible com Redis/Memory store
- **Sanitiza√ß√£o**: express-mongo-sanitize, helmet, xss

**Observabilidade**
- **Logs**: Winston com rota√ß√£o di√°ria
- **M√©tricas**: Prometheus com Grafana
- **Monitoramento**: Sentry (opcional)
- **Health Checks**: Endpoints customizados

**Valida√ß√£o e Documenta√ß√£o**
- **Valida√ß√£o**: Zod schemas
- **API Docs**: Swagger/OpenAPI 3.0

### Arquitetura em Camadas

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              API Layer                  ‚îÇ
‚îÇ  (Routes + Middlewares + Validation)    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ           Business Layer                ‚îÇ
‚îÇ         (Controllers)                   ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ           Service Layer                 ‚îÇ
‚îÇ    (Business Logic + Transactions)     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ            Data Layer                   ‚îÇ
‚îÇ      (Prisma ORM + PostgreSQL)         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üóÑÔ∏è Modelo de Dados

### Entidades Principais

#### Users & Companies (Multi-tenant)
```typescript
User (1) ‚Üê‚Üí (N) UserCompany (N) ‚Üê‚Üí (1) Company
```
- Sistema multi-tenant onde usu√°rios podem pertencer a m√∫ltiplas empresas
- Isolamento completo de dados por empresa

#### Financial Entities
```typescript
Company (1) ‚Üê‚Üí (N) FinancialAccount
Company (1) ‚Üê‚Üí (N) FinancialCategory  
Company (1) ‚Üê‚Üí (N) FinancialTransaction
Company (1) ‚Üê‚Üí (N) RecurringTransaction
```

#### Access Control
```typescript
User (1) ‚Üê‚Üí (N) UserFinancialAccountAccess (N) ‚Üê‚Üí (1) FinancialAccount
```

### Tipos de Transa√ß√£o
- **INCOME**: Receitas (toAccountId obrigat√≥rio)
- **EXPENSE**: Despesas (fromAccountId obrigat√≥rio)  
- **TRANSFER**: Transfer√™ncias (fromAccountId e toAccountId obrigat√≥rios)

### Tipos de Conta
- **CHECKING**: Conta corrente
- **SAVINGS**: Poupan√ßa
- **CREDIT_CARD**: Cart√£o de cr√©dito (permite saldo negativo por padr√£o)
- **INVESTMENT**: Investimentos
- **CASH**: Dinheiro f√≠sico

## üîê Sistema de Permiss√µes

### Hierarquia de Roles

#### ADMIN (N√≠vel Sistema)
- Acesso total a todas as empresas
- Pode criar/editar/deletar empresas
- Pode criar outros ADMINs (apenas na empresa Equinox)
- Acesso irrestrito a todas as funcionalidades

#### SUPERUSER (N√≠vel Empresa)
- Acesso total √† empresa espec√≠fica
- Pode gerenciar usu√°rios da empresa
- Pode conceder/revogar permiss√µes de conta para USERs
- Acesso a todas as contas financeiras da empresa

#### USER (N√≠vel Restrito)
- Acesso apenas √†s contas financeiras explicitamente autorizadas
- Pode ter permiss√µes espec√≠ficas para:
  - `manageFinancialAccounts`: Criar/editar contas
  - `manageFinancialCategories`: Criar/editar categorias

### Controle Granular de Acesso a Contas

O sistema implementa controle granular onde USERs s√≥ podem:
- Ver contas financeiras autorizadas
- Criar transa√ß√µes apenas entre contas acess√≠veis
- Ver transa√ß√µes que envolvem contas acess√≠veis
- Gerar relat√≥rios apenas com dados de contas permitidas

```typescript
// Exemplo de middleware de controle de acesso
export function requireAccountAccess(accountIdParam: string = 'id') {
  return async (req: Request, res: Response, next: NextFunction) => {
    const { userId, role, companyId } = req.user;
    
    if (role === 'ADMIN' || role === 'SUPERUSER') {
      return next(); // Acesso total
    }
    
    const hasAccess = await UserFinancialAccountAccessService
      .checkUserAccountAccess(userId, accountId, role, companyId);
      
    if (!hasAccess) {
      return res.status(403).json({ 
        error: 'Acesso negado a esta conta financeira' 
      });
    }
    
    next();
  };
}
```

## üí∞ Integridade Financeira

### Transa√ß√µes ACID
Todas as opera√ß√µes financeiras s√£o executadas com:
- **Atomicidade**: Opera√ß√£o completa ou rollback total
- **Consist√™ncia**: Valida√ß√µes de neg√≥cio rigorosas
- **Isolamento**: SERIALIZABLE para evitar race conditions
- **Durabilidade**: Commits seguros no PostgreSQL

### Valida√ß√µes Cr√≠ticas
```typescript
// Valida√ß√£o de saldo com suporte a negativo
if (!fromAccount.allowNegativeBalance) {
  if (currentBalance.lt(transactionAmount)) {
    throw new Error(`Insufficient balance. Available: ${currentBalance.toFixed(2)}`);
  }
} else {
  // Log para auditoria quando permite negativo
  logger.warn('Transaction creating negative balance', {
    accountId: fromAccount.id,
    newBalance: newBalance.toFixed(2),
    allowNegativeBalance: true
  });
}
```

### Sistema de Retry e Lock
- **Deadlock Detection**: Retry autom√°tico com backoff exponencial
- **Row Locking**: `FOR UPDATE NOWAIT` para evitar deadlocks
- **Timeout Protection**: Timeouts de 30s para transa√ß√µes longas

## üöÄ Features Avan√ßadas

### Saldo Negativo Configur√°vel
Contas podem ser configuradas para permitir saldo negativo:
- Cart√µes de cr√©dito: Sempre permitem (regra de neg√≥cio)
- Outras contas: Configur√°vel por conta
- Valida√ß√µes espec√≠ficas antes de alterar pol√≠tica

### Transa√ß√µes Recorrentes
Sistema completo de agendamento:
- Frequ√™ncias: DAILY, WEEKLY, MONTHLY, QUARTERLY, YEARLY
- Configura√ß√£o de dia espec√≠fico do m√™s/semana
- Gera√ß√£o autom√°tica de transa√ß√µes futuras
- Proje√ß√µes sem criar registros

### Relat√≥rios Din√¢micos
Sistema de relat√≥rios flex√≠vel:
- Agrupamento por dia/semana/m√™s
- Filtros por contas, categorias, per√≠odos
- Exporta√ß√£o para PDF/Excel
- Respeitam permiss√µes de acesso

### Cache Inteligente
Sistema de cache com invalida√ß√£o autom√°tica:
```typescript
// Cache por opera√ß√£o com TTL espec√≠fico
app.use('/api/financial/summary', cacheMiddleware(600)); // 10min
app.use('/api/financial/accounts', cacheMiddleware(300)); // 5min
app.use('/api/financial/transactions', cacheMiddleware(120)); // 2min
```

## üìä Monitoramento e Observabilidade

### M√©tricas Prometheus
- **HTTP Request Duration**: Histograma de performance
- **Error Rate**: Contador de erros por rota
- **Custom Metrics**: Empresas criadas, transa√ß√µes processadas
- **System Metrics**: CPU, mem√≥ria, event loop

### Logs Estruturados
```typescript
logger.info('Financial transaction completed successfully', {
  transactionId,
  type: data.type,
  amount: parsedAmount.toString(),
  duration: Date.now() - startTime,
  accountsAffected: accountsToLock.length
});
```

### Health Checks
Endpoint `/health` com verifica√ß√£o de:
- Status da aplica√ß√£o
- Conex√£o com PostgreSQL  
- Status do Redis (se habilitado)
- M√©tricas de cache e rate limiting

## üîß Rate Limiting Avan√ßado

### Estrat√©gia Multi-Camada
```typescript
const rateLimiters = {
  auth: { points: 5, duration: 900 },      // Login restritivo
  api: { points: 100, duration: 60 },      // API geral
  financial: { points: 30, duration: 60 }, // Opera√ß√µes financeiras
  reports: { points: 10, duration: 300 }   // Relat√≥rios pesados
};
```

### Prote√ß√£o Anti-Brute Force
- Rate limiting por IP e email
- Penalidades progressivas
- Bloqueio tempor√°rio ap√≥s tentativas excessivas

## üê≥ Deployment e DevOps

### Docker Multi-Stage
```dockerfile
# Stage 1: Builder (dependencies + build)
FROM node:20-alpine AS builder
# ... build process

# Stage 2: Production (runtime only)
FROM node:20-alpine AS production
# ... optimized runtime
```

### Configura√ß√£o Flex√≠vel
Sistema de configura√ß√£o baseado em ambiente:
- Redis habilitado/desabilitado via `REDIS_ENABLED`
- Logs para arquivo em produ√ß√£o
- Configura√ß√µes espec√≠ficas por ambiente

### Health e Readiness
- Graceful shutdown com SIGTERM/SIGINT
- Health checks para Kubernetes/Docker
- Startup probes para migrations

## üìà Escalabilidade

### Horizontal Scaling
- Stateless design permite m√∫ltiplas inst√¢ncias
- Redis para sess√µes compartilhadas
- Rate limiting distribu√≠do

### Database Optimization
- √çndices otimizados para queries financeiras
- Conex√£o pooling com Prisma
- Query optimization com includes seletivos

### Cache Strategy
- Cache em m√∫ltiplas camadas
- Invalida√ß√£o autom√°tica por opera√ß√£o
- Fallback para memory store

## üîÆ Decis√µes de Design

### Por que Prisma?
- Type safety com TypeScript
- Migrations autom√°ticas
- Query building otimizado
- Introspection e schema management

### Por que Redis Opcional?
- Desenvolvimento mais simples sem depend√™ncias
- Memory store para rate limiting funciona localmente  
- Redis ativado apenas quando necess√°rio (produ√ß√£o/m√∫ltiplas inst√¢ncias)

### Por que Zod?
- Valida√ß√£o type-safe
- Transforma√ß√µes autom√°ticas
- Integra√ß√£o perfeita com TypeScript
- Mensagens de erro customiz√°veis

### Por que Decimal para Money?
- Precis√£o financeira sem floating point errors
- Opera√ß√µes matem√°ticas seguras
- Suporte nativo do Prisma

## üö® Seguran√ßa Enterprise

### OWASP Compliance
- Input sanitization
- SQL injection prevention (Prisma)
- XSS protection
- CORS configur√°vel
- Security headers (Helmet)

### Auditoria Completa
- Log de todas opera√ß√µes financeiras
- Rastreamento de permiss√µes concedidas/revogadas
- Request IDs para debugging
- Contexto completo em logs

### Secrets Management
- Environment variables para configura√ß√µes sens√≠veis
- JWT secrets obrigat√≥rios em produ√ß√£o
- Configura√ß√£o segura de banco de dados

## üìö Documenta√ß√£o e Manutenibilidade

### API Documentation
- Swagger/OpenAPI 3.0 completo
- Schemas tipados
- Exemplos de request/response

### Code Organization
- Separation of concerns clara
- Services para l√≥gica de neg√≥cio
- Controllers para HTTP handling
- Middlewares para cross-cutting concerns

### Error Handling
- Error middleware centralizado
- C√≥digos de erro espec√≠ficos
- Mensagens contextuais
- Stack traces em desenvolvimento

## üîÑ Padr√µes de Migra√ß√£o

### Database Migrations
- Prisma migrations autom√°ticas
- Seeds para dados iniciais
- Rollback strategies

### Backward Compatibility
- Versionamento de API impl√≠cito
- Campos opcionais para novos features
- Deprecation warnings quando necess√°rio

---

## üìù Conclus√£o

O Zenit Core representa uma solu√ß√£o enterprise completa para gest√£o financeira, combinando robustez t√©cnica com flexibilidade operacional. O sistema foi desenhado para crescer com as necessidades do neg√≥cio, mantendo sempre a integridade dos dados financeiros e a seguran√ßa como prioridades absolutas.

A arquitetura modular e as decis√µes de design permitem f√°cil manuten√ß√£o e evolu√ß√£o, enquanto as ferramentas de observabilidade garantem opera√ß√£o confi√°vel em ambiente de produ√ß√£o.

## üé® Arquitetura T√©cnica Frontend

### Stack Tecnol√≥gico Frontend

**Core Framework**
- **Next.js 15.3.1**: Framework React com SSR/SSG
- **React 18.3.1**: Biblioteca de interface de usu√°rio
- **TypeScript 5.8.3**: Linguagem tipada para desenvolvimento seguro
- **Tailwind CSS 3.4.17**: Framework CSS utility-first

**UI e Experi√™ncia**
- **Sistema de Temas Din√¢micos**: CSS Variables com 12+ temas
- **Lucide React**: Biblioteca de √≠cones moderna
- **Recharts**: Gr√°ficos e visualiza√ß√µes
- **Responsive Design**: Mobile-first com breakpoints otimizados

**Autentica√ß√£o e Estado**
- **Context API**: Gerenciamento de estado global
- **JWT Authentication**: Tokens com refresh autom√°tico
- **Role-Based Access Control**: Controle granular por componente
- **Protected Routes**: Middleware de prote√ß√£o autom√°tica

### Arquitetura em Camadas Frontend

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              Pages Layer                ‚îÇ
‚îÇ    (Next.js App Router + Layouts)      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ           Components Layer              ‚îÇ
‚îÇ  (UI Components + Business Components) ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ            Context Layer                ‚îÇ
‚îÇ      (Auth + Theme + Toast)            ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ             Hooks Layer                 ‚îÇ
‚îÇ   (Custom Hooks + API Integration)     ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ              API Layer                  ‚îÇ
‚îÇ        (Axios + Interceptors)          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üéØ Sistema de Temas Din√¢micos

### Conceito Inovador
O frontend implementa um sistema de temas √∫nico que permite mudan√ßa de cores em tempo real atrav√©s de CSS Variables, proporcionando personaliza√ß√£o completa da interface sem recarregamento.

### Implementa√ß√£o T√©cnica

#### CSS Variables Din√¢micas
```css
:root {
  --color-primary: #f59e0b;
  --color-primary-hover: #e08c07;
  --color-primary-light: #fbbf24;
  --color-primary-dark: #d97706;
  --color-primary-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
  --color-primary-shadow: 0 10px 25px rgba(245, 158, 11, 0.3);
}
```

#### Tailwind Integration
```javascript
module.exports = {
  theme: {
    extend: {
      colors: {
        accent: 'var(--color-primary, #f59e0b)',
        'accent-hover': 'var(--color-primary-hover, #e08c07)',
        'accent-light': 'var(--color-primary-light, #fbbf24)',
      },
    },
  },
};
```

### Cat√°logo de Temas
- **Standard** (4 temas): √Çmbar, Azul, Esmeralda, Roxo
- **Vibrant** (3 temas): Laranja, Rosa, Ciano vibrantes
- **Professional** (3 temas): Ard√≥sia, Cinza, √çndigo corporativo
- **Seasonal** (2 temas): Natal, Ver√£o

### Context de Temas
```typescript
export function ThemeProvider({ children }: { children: ReactNode }) {
  const [currentTheme, setCurrentTheme] = useState<string>('amber');
  
  const applyTheme = (theme: Theme) => {
    const root = document.documentElement;
    root.style.setProperty('--color-primary', theme.colors.primary);
    // ... outras propriedades
  };
  
  const changeTheme = (themeKey: string) => {
    const theme = AVAILABLE_THEMES.find(t => t.key === themeKey);
    if (theme) {
      setCurrentTheme(themeKey);
      localStorage.setItem('selected-theme', themeKey);
      applyTheme(theme);
    }
  };
}
```

## üîê Sistema de Autentica√ß√£o Frontend

### AuthContext Avan√ßado
```typescript
interface AuthContextData {
  token: string | null;
  user: User | null;
  login: (email: string, password: string) => Promise<void>;
  logout: () => void;
  refreshToken: () => Promise<boolean>;
  userRole: string | null;
  userId: number | null;
  companyId: number | null;
  manageFinancialAccounts: boolean;
  manageFinancialCategories: boolean;
}
```

### Caracter√≠sticas de Seguran√ßa

#### Gerenciamento Seguro de Tokens
- **Dual Storage**: localStorage + httpOnly cookies
- **Auto-refresh**: Renova√ß√£o autom√°tica antes da expira√ß√£o
- **Cleanup Seguro**: Remo√ß√£o espec√≠fica apenas dos dados da aplica√ß√£o
- **Rate Limiting**: Prote√ß√£o contra tentativas de login

#### Middleware de Prote√ß√£o
```typescript
export function middleware(request: NextRequest) {
  const { pathname } = request.nextUrl;
  const token = request.cookies.get('zenit_token')?.value;
  
  if (!isPublicRoute && !token) {
    const url = new URL('/login', request.url);
    url.searchParams.set('redirect', pathname);
    return NextResponse.redirect(url);
  }
  
  return NextResponse.next();
}
```

### Sistema de Permiss√µes Granular

#### Hook de Permiss√µes
```typescript
export function usePermissions() {
  const { userRole, manageFinancialAccounts, manageFinancialCategories } = useAuth();
  
  const hasPermission = (config: PermissionConfig): boolean => {
    // L√≥gica de hierarquia de roles
    // Verifica√ß√£o de permiss√µes espec√≠ficas
    // Suporte a roles negados e permitidos
  };
  
  return {
    hasPermission,
    canManageCompanies: () => hasRole('ADMIN'),
    canManageUsers: () => hasRole('SUPERUSER'),
    hasAppPermission: (perm) => // L√≥gica espec√≠fica
  };
}
```

#### AccessGuard Component
```typescript
export function AccessGuard({
  children,
  requiredRole,
  allowedRoles,
  requiredPermission,
  fallback,
  showFallback = true
}: AccessGuardProps) {
  const { hasPermission, hasAppPermission } = usePermissions();
  
  // Verifica√ß√£o de acesso
  // Renderiza√ß√£o condicional
  // Fallback autom√°tico com informa√ß√µes de permiss√£o
}
```

## üß© Arquitetura de Componentes

### Sistema de Design Consistente

#### Componentes Base
- **Card**: Container base com varia√ß√µes
- **Button**: 4 variantes com estados din√¢micos
- **Input**: Campos com valida√ß√£o e estados
- **Select**: Seletores customizados
- **CurrencyInput**: Input monet√°rio com m√°scara brasileira

#### Componentes Avan√ßados
- **AutocompleteInput**: Busca com sugest√µes baseadas em hist√≥rico
- **ThemeSelector**: Seletor visual de temas com categorias
- **ConfirmationModal**: Modal de confirma√ß√£o reutiliz√°vel
- **SmartNavigation**: Navega√ß√£o com permiss√µes autom√°ticas

### Layout System

#### DashboardLayout
```typescript
export function DashboardLayout({ children, title }: DashboardLayoutProps) {
  return (
    <div className="flex flex-col h-screen bg-[#1e2126]">
      <Header />
      <div className="flex h-full pt-[60px]">
        <Sidebar />
        <MainContent>{children}</MainContent>
      </div>
    </div>
  );
}
```

#### Sidebar Inteligente
- **Navega√ß√£o Contextual**: Itens baseados em permiss√µes
- **Submenu Flutuante**: UX otimizada para diferentes resolu√ß√µes
- **Estado Persistente**: Lembra prefer√™ncias do usu√°rio
- **Visual Feedback**: Indicadores de estado ativo

### Hooks Personalizados

#### useModalDrawer
```typescript
export function useModalDrawer({ baseUrl }: UseModalDrawerOptions) {
  const [isOpen, setIsOpen] = useState(false);
  const [action, setAction] = useState<ModalAction>(null);
  
  // Sincroniza√ß√£o com URL
  // Controle de estado autom√°tico
  // Helpers para diferentes a√ß√µes
}
```

#### useConfirmation
```typescript
export function useConfirmation(): UseConfirmationReturn {
  const confirm = useCallback((
    options: ConfirmationOptions,
    onConfirm: () => Promise<void> | void,
    onCancel?: () => void
  ) => {
    // Gerenciamento de estado de confirma√ß√£o
    // Suporte a callbacks ass√≠ncronos
    // Tratamento de erros
  });
}
```

## üì± Experi√™ncia do Usu√°rio

### Responsive Design
- **Mobile-First**: Design otimizado para dispositivos m√≥veis
- **Breakpoints Inteligentes**: Adapta√ß√£o autom√°tica de layout
- **Touch-Friendly**: Controles otimizados para toque
- **Performance Mobile**: Carregamento otimizado

### Acessibilidade (A11y)
- **ARIA Labels**: Sem√¢ntica adequada para leitores de tela
- **Keyboard Navigation**: Navega√ß√£o completa por teclado
- **Color Contrast**: Temas testados para contraste adequado
- **Focus Management**: Estados de foco vis√≠veis e l√≥gicos

### Micro-Intera√ß√µes
```css
.hover-lift:hover {
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.animate-fadeIn {
  animation: fadeIn 0.2s ease-in-out;
}
```

## üîÑ Gerenciamento de Estado

### Context Strategy
```typescript
// M√∫ltiplos contextos especializados
<ThemeProvider>
  <AuthProvider>
    <ToastProvider>
      <AppContent />
    </ToastProvider>
  </AuthProvider>
</ThemeProvider>
```

### Local State Management
- **useState**: Estados simples de componente
- **useReducer**: Estados complexos com l√≥gica
- **Custom Hooks**: Abstra√ß√£o de l√≥gica reutiliz√°vel
- **URL State**: Sincroniza√ß√£o com par√¢metros de URL

### API Integration

#### Axios Configuration
```typescript
const api = axios.create({
  baseURL: process.env.NEXT_PUBLIC_API_URL || '/api',
});

api.interceptors.request.use(config => {
  const token = localStorage.getItem('zenit_token');
  if (token && config.headers) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});
```

#### Error Handling
- **Interceptors**: Tratamento autom√°tico de erros
- **Toast Notifications**: Feedback visual consistente
- **Retry Logic**: Tentativas autom√°ticas para falhas de rede
- **Graceful Degradation**: Fallbacks para cen√°rios de erro

## üìä Funcionalidades Avan√ßadas

### Dashboard Financeiro
- **Gr√°ficos Interativos**: Recharts com dados em tempo real
- **Filtros Din√¢micos**: Per√≠odo, tipo, contas
- **Responsividade**: Adapta√ß√£o autom√°tica de layout
- **Performance**: Lazy loading e memoiza√ß√£o

### Sistema de Relat√≥rios
```typescript
export default function FinancialMovementReport() {
  const [zoomLevel, setZoomLevel] = useState(150);
  
  // Controles de zoom para visualiza√ß√£o
  // Exporta√ß√£o PDF/Excel
  // Preview de impress√£o
  // Filtros avan√ßados
}
```

### Transa√ß√µes com Autocomplete
```typescript
const fetchAutocompleteSuggestions = async (query: string): Promise<AutocompleteSuggestion[]> => {
  const response = await api.get('/financial/transactions/autocomplete', {
    params: { 
      q: query,
      type: formData.type // Filtro por tipo de transa√ß√£o
    }
  });
  return response.data.suggestions || [];
};
```

## üöÄ Performance e Otimiza√ß√£o

### Build Optimization
```javascript
// next.config.js
const nextConfig = {
  reactStrictMode: true,
  // Otimiza√ß√µes autom√°ticas do Next.js
  // Tree shaking
  // Code splitting autom√°tico
};
```

### Bundle Analysis
- **Dynamic Imports**: Carregamento sob demanda
- **Component Lazy Loading**: Componentes carregados quando necess√°rio
- **Asset Optimization**: Imagens e recursos otimizados
- **Cache Strategy**: Headers de cache configurados

### Runtime Performance
- **Memoization**: React.memo e useMemo para componentes pesados
- **Virtual Scrolling**: Para listas grandes
- **Debouncing**: Em campos de busca e filtros
- **Intersection Observer**: Para carregamento progressivo

## üê≥ Deploy e DevOps Frontend

### Docker Multi-Stage
```dockerfile
FROM node:20-alpine

WORKDIR /app

ARG NEXT_PUBLIC_API_URL
ARG NODE_ENV=production
ENV NEXT_PUBLIC_API_URL=$NEXT_PUBLIC_API_URL
ENV NODE_ENV=$NODE_ENV

COPY package*.json ./
RUN npm ci

COPY . .
RUN npm run build

EXPOSE 3000
CMD ["npm", "start"]
```

### Environment Configuration
- **Build-time Variables**: NEXT_PUBLIC_API_URL
- **Runtime Configuration**: Baseado em NODE_ENV
- **Feature Flags**: Controle de funcionalidades por ambiente
- **Health Checks**: Endpoints para monitoramento

## üîß Desenvolvimento e Manutenibilidade

### Code Organization
```
frontend/
‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îú‚îÄ‚îÄ ui/           # Componentes b√°sicos
‚îÇ   ‚îú‚îÄ‚îÄ admin/        # Funcionalidades administrativas
‚îÇ   ‚îú‚îÄ‚îÄ financial/    # M√≥dulo financeiro
‚îÇ   ‚îî‚îÄ‚îÄ layout/       # Layout e navega√ß√£o
‚îú‚îÄ‚îÄ contexts/         # Context providers
‚îú‚îÄ‚îÄ hooks/           # Custom hooks
‚îú‚îÄ‚îÄ lib/             # Utilit√°rios e configura√ß√µes
‚îú‚îÄ‚îÄ pages/           # P√°ginas Next.js
‚îî‚îÄ‚îÄ styles/          # Estilos globais
```

### TypeScript Integration
- **Strict Mode**: Configura√ß√£o rigorosa de tipos
- **Custom Types**: Interfaces espec√≠ficas do dom√≠nio
- **API Types**: Tipagem das respostas da API
- **Component Props**: Props tipadas para todos os componentes

### Development Experience
- **Hot Reload**: Atualiza√ß√£o em tempo real
- **Error Boundaries**: Captura e tratamento de erros
- **DevTools**: Integra√ß√£o com React DevTools
- **Debug Info**: Logs estruturados para desenvolvimento

## üìà Escalabilidade Frontend

### Component Scalability
- **Composition Pattern**: Componentes compostos
- **Render Props**: Padr√£o para l√≥gica reutiliz√°vel
- **Higher-Order Components**: Funcionalidades transversais
- **Custom Hooks**: Abstra√ß√£o de l√≥gica de neg√≥cio

### State Scalability
- **Context Splitting**: M√∫ltiplos contextos especializados
- **Local vs Global**: Estrat√©gia clara de estado
- **Memoization Strategy**: Otimiza√ß√£o de re-renders
- **Async State**: Gerenciamento de estados ass√≠ncronos

### Feature Scalability
- **Module Federation**: Preparado para micro-frontends
- **Plugin Architecture**: Sistema extens√≠vel
- **Feature Flags**: Controle granular de funcionalidades
- **A/B Testing**: Infraestrutura para testes

## üõ°Ô∏è Seguran√ßa Frontend

### Client-Side Security
- **XSS Prevention**: Sanitiza√ß√£o de entradas
- **CSRF Protection**: Tokens de prote√ß√£o
- **Content Security Policy**: Headers de seguran√ßa
- **Secure Storage**: Estrat√©gia segura para tokens

### Authentication Security
- **Token Rotation**: Renova√ß√£o autom√°tica
- **Session Management**: Controle de sess√µes
- **Secure Cookies**: Configura√ß√£o adequada
- **Rate Limiting**: Prote√ß√£o contra ataques

## üîÆ Decis√µes de Design Frontend

### Por que Next.js?
- **SSR/SSG**: Performance e SEO otimizados
- **File-based Routing**: Sistema intuitivo de rotas
- **API Routes**: Backend integrado quando necess√°rio
- **Image Optimization**: Otimiza√ß√£o autom√°tica de imagens

### Por que Tailwind CSS?
- **Utility-First**: Desenvolvimento r√°pido e consistente
- **CSS Variables**: Integra√ß√£o perfeita com sistema de temas
- **Tree Shaking**: CSS otimizado automaticamente
- **Developer Experience**: IntelliSense e autocomplete

### Por que Context API?
- **Built-in**: Nativo do React, sem depend√™ncias
- **Type Safety**: Integra√ß√£o perfeita com TypeScript
- **Performance**: Controle fino de re-renders
- **Simplicidade**: Menos complexidade que Redux

### Por que CSS Variables para Temas?
- **Performance**: Mudan√ßas instant√¢neas sem re-render
- **Flexibilidade**: Suporte a qualquer propriedade CSS
- **Browser Support**: Amplamente suportado
- **Developer Experience**: F√°cil de usar e manter

---

## üåü Conclus√£o Frontend

O frontend do Zenit Core representa uma implementa√ß√£o moderna e escal√°vel de uma interface de usu√°rio enterprise, combinando as melhores pr√°ticas de desenvolvimento React com inova√ß√µes pr√≥prias como o sistema de temas din√¢micos.

A arquitetura foi pensada para crescer com o produto, mantendo performance, acessibilidade e experi√™ncia do usu√°rio como pilares fundamentais. O sistema de permiss√µes granular garante que cada usu√°rio veja apenas o que deve ver, enquanto o design system consistente proporciona uma experi√™ncia coesa em toda a aplica√ß√£o.

A integra√ß√£o perfeita entre frontend e backend atrav√©s de APIs tipadas e autentica√ß√£o segura garante uma experi√™ncia fluida e confi√°vel para os usu√°rios finais.